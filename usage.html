

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Deconvolution: Usage guide &mdash; deconwolf 0.4.4 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />

  
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=90733dfc"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Spot detection and measurements" href="spots.html" />
    <link rel="prev" title="Installation notes" href="install.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            deconwolf
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="start.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation notes</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Deconvolution: Usage guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#dont-expect-too-much">Don’t expect too much</a></li>
<li class="toctree-l2"><a class="reference internal" href="#running-deconwolf">Running deconwolf</a></li>
<li class="toctree-l2"><a class="reference internal" href="#test-data">Test data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#memory-considerations">Memory considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#psf-considerations">PSF considerations</a></li>
<li class="toctree-l2"><a class="reference internal" href="#supported-image-formats">Supported image formats</a></li>
<li class="toctree-l2"><a class="reference internal" href="#log-files">Log files</a></li>
<li class="toctree-l2"><a class="reference internal" href="#output-format">Output format</a></li>
<li class="toctree-l2"><a class="reference internal" href="#questions-and-answers">Questions and Answers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#i-have-a-gpu-that-i-want-to-use-what-can-i-do">I have a GPU that I want to use, what can I do?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#do-i-really-need-to-specify-the-number-of-iterations">Do I really need to specify the number of iterations?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#it-takes-a-long-time-before-deconwolf-starts-iterating">It takes a long time before deconwolf starts iterating</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-prepare-tif-files-for-deconwolf">How can I prepare tif files for deconwolf?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-do-i-get-metadata-from-nd2-files">How do I get metadata from ND2-files?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#how-can-i-run-deconwolf-for-many-files">How can I run deconwolf for many files?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dont-you-have-more-psf-models">Don’t you have more PSF models?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#what-about-image-dimensions">What about image dimensions?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#maximizing-throughput">Maximizing throughput</a></li>
<li class="toctree-l3"><a class="reference internal" href="#d-images">2D images?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#my-question-was-not-in-this-list">My question was not in this list!</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="spots.html">Spot detection and measurements</a></li>
<li class="toctree-l1"><a class="reference internal" href="shifts.html">Spot-based image alignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="segmentation.html">Ilastic-like segmentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="history.html">Version History</a></li>
<li class="toctree-l1"><a class="reference internal" href="license.html">GNU General Public License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">deconwolf</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Deconvolution: Usage guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/usage.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="deconvolution-usage-guide">
<h1>Deconvolution: Usage guide<a class="headerlink" href="#deconvolution-usage-guide" title="Link to this heading"></a></h1>
<section id="dont-expect-too-much">
<h2>Don’t expect too much<a class="headerlink" href="#dont-expect-too-much" title="Link to this heading"></a></h2>
<p>When working with real widefield images, in contrast to synthetic ones,
it is important to know that the success or failure of deconvolution
depends on several factors and that there are limitations that can not
be overcome.</p>
<p>Most important, the results will always be limited by mismatches between
the PSF of the microscopy and what is given as input to the software
(PSF mismatch).</p>
<p>The “Born and Wolf” PSF model that is included with deconwolf should be
a good, or at least simple, starting point since it only requires very
few parameters. Please be aware there is a compromise between simplicity
and accuracy, especially the Born and Wolf model relies on several
assumptions that typically are met. For instance you can see that such
PSFs are symmetric both around the lateral plane and around the z-axis.
That is something I’ve never seen in real images.</p>
<p>It is likely that better results can be obtained by using more advanced
models (like the Gibson-Lanni) or by experimentally estimating the PSF
based on image data (of beads). However, to find a better PSF for a
specific microscope is typically quite complicated.</p>
<p>Richardson-Lucy based methods assume that the image formation can be
described as a linear process, something which is only approximate since
any interesting sample will both absorb and refract light. Saturated
pixel in the input image clearly violates the linearity assumption so
please check for that before deconvolution.</p>
<p>Saturated pixels, sensor noise, sensor artifacts, PSF mismatches, an
excessive number of iterations, …, can cause artifacts. Ideally one
should acquire samples also with super resolution, to be in a position
to recognize and distinguish interesting features from potential
artefacts.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Deconvolution is not guaranteed to improve microscopy
images and might introduce artefacts.</p>
</div>
</section>
<section id="running-deconwolf">
<h2>Running deconwolf<a class="headerlink" href="#running-deconwolf" title="Link to this heading"></a></h2>
<p>Deconwolf has a command line interface (CLI), and can be run from a
terminal or script. There is also a limited
<a class="reference external" href="https://github.com/elgw/deconwolf-gui">GUI</a> that might be handy, at
least initially.</p>
<p>To deconvolve an image (let’s call it <code class="docutils literal notranslate"><span class="pre">dapi_001.tif</span></code>) you need an
approximation of the PSF of your particular microscope at the given
emission wave length.</p>
<p>If you don’t have one you can create one according to the Born-Wolf
model with the <code class="docutils literal notranslate"><span class="pre">dw_bw</span></code> program that is shipped with deconwolf.</p>
<p>The basic information that you need to know is: - The numerical
aperture, NA. - The refractive index of the immersion, ni. Common media
are air (ni = 1) and oil (ni = 1.51) and silicon oil (ni = 1.405). - The
lateral size of the pixels in the <strong>image</strong> – NOT the size of the pixels
in the sensor. - The axial size of the pixels in the image,
i.e. distance between the images/planes.</p>
<p>For example: one of our microscopes has a 100x objectives with NA =
1.45, ni = 1.515 and pixel size is 130 nm. The distance between planes
was set to 250 nm. To generate a PSF with this information (we will call
it <code class="docutils literal notranslate"><span class="pre">PSF_dapi.tif</span></code>) the following command can be used:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dw_bw<span class="w"> </span>--resxy<span class="w"> </span><span class="m">130</span><span class="w"> </span>--resz<span class="w"> </span><span class="m">250</span><span class="w"> </span>--lambda<span class="w"> </span><span class="m">461</span><span class="w"> </span>--NA<span class="w"> </span><span class="m">1</span>.45<span class="w"> </span>--ni<span class="w"> </span><span class="m">1</span>.515<span class="w"> </span>PSF_dapi.tif
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can of course re-use the PSF with multiple images. Please
make sure to keep the <code class="docutils literal notranslate"><span class="pre">.log.txt</span></code> file, generated along with the
PSF, to know what parameters were used.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Please note that deconwolf does not read any meta data from
the tif files regarding pixel size etc. Hence it is the PSF file that
determines those factors implicitly.</p>
</div>
<p>With a PSF at hand the image can be deconvolved with a command line like
this:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dw<span class="w"> </span>--iter<span class="w"> </span><span class="m">40</span><span class="w"> </span>dapi_001.tif<span class="w"> </span>psf_dapi.tif
</pre></div>
</div>
<p>When done, <strong>dw</strong> will write a new image called <code class="docutils literal notranslate"><span class="pre">dw_dapi_001.tif</span></code>
along with a log file called <code class="docutils literal notranslate"><span class="pre">dw_dapi_001.tif.log.txt</span></code>.</p>
<p>For a list of the available command line options, please see:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>dw<span class="w"> </span>--help
dw_bw<span class="w"> </span>--help
</pre></div>
</div>
<p>On Linux/Mac there should also be manuals installed which can be opened
by:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>man<span class="w"> </span>dw
man<span class="w"> </span>dw_bw
</pre></div>
</div>
<p>If the manuals are not available on your system, they can also be found
at this link [<a class="reference external" href="https://github.com/elgw/deconwolf/tree/master/doc">https://github.com/elgw/deconwolf/tree/master/doc</a>].</p>
</section>
<section id="test-data">
<h2>Test data<a class="headerlink" href="#test-data" title="Link to this heading"></a></h2>
<p>If you want to test that <strong>dw</strong> works, there is a small image of a
single nuclei in the <code class="docutils literal notranslate"><span class="pre">demo</span></code> subfolder. The image is small enough that
it can be deconvolved with very modest hardware.</p>
<p>More test images can be found on the
<a class="reference external" href="http://bigwww.epfl.ch/deconvolution/deconvolutionlab2/">DeconvolutionLab2</a>
web page. Please note that in some cases the PSFs do not contain enough
z-planes for a proper deconvolution.</p>
</section>
<section id="memory-considerations">
<h2>Memory considerations<a class="headerlink" href="#memory-considerations" title="Link to this heading"></a></h2>
<p>If you have 16 GB of RAM, images up to [1024x1024x60] pixels should work
without tiling. If deconwolf crashes because it runs of out memory you
can:</p>
<ol class="arabic simple">
<li><p>Consider removing top and bottom slices from the image. The boundary
handling in the axial direction is quite good so often there is no
need for a lot of out of focus images planes above and below the
objects of interest.</p></li>
<li><p>Use the <strong>–tilesize N</strong> option. To process the image as slightly
overlapping tiles.</p></li>
<li><p>Use fewer threads, i.e. specify <strong>–threads N</strong>.</p></li>
<li><p>Consider switching to a lower quality on the boundaries with <strong>–bq
1</strong>. The option <strong>–bq 0</strong> is not recommended for normal images (since
it assumes that the image repeats itself around the edges which is
bad particularly in the axial direction).</p></li>
</ol>
<p>The peak memory usage is written at the end of the log file (at least if
run on Linux).</p>
</section>
<section id="psf-considerations">
<h2>PSF considerations<a class="headerlink" href="#psf-considerations" title="Link to this heading"></a></h2>
<p>The <strong>dw_bw</strong> program will generate PSFs that can be used with
deconwolf, but it is also possible to use PSF from other sources.</p>
<p>deconwolf requires that the PSF is centered, i.e., that the largest
value is in the middle. If you generate the PSF with some other program
you might have to center it first. In our experience it is better to
have a PSF with odd sizes, i.e. that the PSF is centered at a certain
pixel and not between them. Ideally the PSF should have at least
<span class="math notranslate nohighlight">\(2P-1\)</span> planes where <span class="math notranslate nohighlight">\(P\)</span> is the number of planes of the input
image.</p>
<p>If the PSF has more planes than needed, it will be cropped automatically
when loaded. If it has fewer than the ideal number of planes, an warning
will be issued.</p>
<p>The PSF might also be cropped in the lateral plane when loaded (to save
some memory). To prevent that, add the command line argument <strong>–xyfactor
0</strong>.</p>
</section>
<section id="supported-image-formats">
<h2>Supported image formats<a class="headerlink" href="#supported-image-formats" title="Link to this heading"></a></h2>
<p>Currently deconwolf can only read tif images, specifically: multi-page,
8-bit unsigned, 16-bit unsigned or 32-bit floats. The data should be
written in strip mode (typically the default output format). The output
is either 16-bit unsigned or 32-bit floating point (with the <strong>–float</strong>
flag) and can be read by Matlab, ImageJ, etc. If you use 16-bit output
note that images will be scaled in order to not be saturated. The
scaling value can be found at the end of the log files.</p>
<p>It is undefined behavior to use pyramidal (multiple resolution) or
multi-color images.</p>
</section>
<section id="log-files">
<h2>Log files<a class="headerlink" href="#log-files" title="Link to this heading"></a></h2>
<ul>
<li><p>The reported error, Idiv, is the I-divergence between the input image
and the current guess convolved with the PSF. Please note that
deconwolf doesn’t know how the deconvolved images should look like so
this isn’t in any way a measurement of how good image quality you get
out of the program.</p></li>
<li><p>If deconwolf finished normally you will find that it ends with
something like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Iteration  24/ 25, Idiv=5.539379e-01
Iteration  25/ 25, Idiv=5.426050e-01
Deconvolution took 15.52 s
2.452803% pixels at bg level in the output image.
scaling: 2.975924
Took: 17.723509 s
peakMemory: 18486288 kiB
2024-03-08T11:33:34
</pre></div>
</div>
<p>If it doesn’t, chances are that deconwolf run out of memory and
crashed.</p>
</li>
</ul>
</section>
<section id="output-format">
<h2>Output format<a class="headerlink" href="#output-format" title="Link to this heading"></a></h2>
<p>Internally deconwolf use 32-bit floating point precision but when it is
time to write the output image to disk 16-bit unsigned tif images are
used by default since that is more memory efficient, and 16-bits per
pixel should be good enough in most cases.</p>
<p>To prevent clipping/saturation and to make full use of the 16-bit
dynamic range all pixel values are scaled by a scaling factor,
<span class="math notranslate nohighlight">\(s\)</span>, prior to writing. The value of the scaling factor is based on
the deconvolved image, <span class="math notranslate nohighlight">\(Y\)</span>, and set as
<span class="math notranslate nohighlight">\(s=(2^{16}-1)/\max(Y)\)</span>.</p>
<p>The scaling is reported in the log file like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ cat dw_dapi_001.tif.log.txt | grep scaling
scaling: 0.425100
</pre></div>
</div>
<p>If you care about the absolute intensities there are three things you
can do:</p>
<ol class="arabic simple">
<li><p>Use the <strong>–float</strong> argument to save images as 32-bit floating point
tif files. The downside is that the output images will be twice as
large compared to the default and that the support for reading such
images is not widespread.</p></li>
<li><p>Set a scaling factor manually by using <strong>–scale s</strong> where <span class="math notranslate nohighlight">\(v\)</span>
is some value that you have to figure out yourself. <span class="math notranslate nohighlight">\(s==1\)</span> is a
natural choice to start with but might cause saturated pixels. If
that is the case reduce <span class="math notranslate nohighlight">\(s\)</span> until you are satisfied. For
example, if you use <strong>–scale 0.5</strong> the output pixels will have only
half of the computed value, if you load the images you can then
multiply the pixel values by <span class="math notranslate nohighlight">\(2\)</span> to get the original values
back.</p></li>
<li><p>Read the scaling value from the log files and divide by that value to
get the computed intensities back.</p></li>
</ol>
</section>
<section id="questions-and-answers">
<h2>Questions and Answers<a class="headerlink" href="#questions-and-answers" title="Link to this heading"></a></h2>
<section id="i-have-a-gpu-that-i-want-to-use-what-can-i-do">
<h3>I have a GPU that I want to use, what can I do?<a class="headerlink" href="#i-have-a-gpu-that-i-want-to-use-what-can-i-do" title="Link to this heading"></a></h3>
<p>Congratulations, that will make deconwolf run much faster. In general
you only need to supply the command line argument <strong>–gpu</strong> to enable GPU
acceleration. However, there are some things to take into consideration:</p>
<ul>
<li><p>Was deconwolf compiled with GPU support? If you run <code class="docutils literal notranslate"><span class="pre">dw</span> <span class="pre">--version</span></code>
the output should include:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>OpenCL:<span class="w"> </span>YES
VkFFT:<span class="w"> </span>YES
</pre></div>
</div>
<p>if not, you need to re-build with the GPU options turned on.</p>
</li>
<li><p>Does OpenCL work on you machine? On linux you can check with the
command line program <code class="docutils literal notranslate"><span class="pre">clinfo</span></code>. In some cases you need to download
specific drivers/software from the GPU vendor.</p></li>
<li><p>Do you have enough memory? The GPU based pipeline use about as much
GPU memory as the non-gpu pipeline use RAM. If you first deconvolve
an image with without the <strong>–gpu</strong> option you can check the log file
(at least under linux) to figure out how much RAM was used. If there
isn’t enough memory on the GPU there is the option to deconvolve
using tiles, see the info about the <strong>–tilesize</strong> option.</p></li>
<li><p>The results will not be pixel identical to images deconvolved without
the <strong>–gpu</strong> option. However differences should be negligable (if
not, please report a bug). This is because the FFT libraries have a
limited precision.</p></li>
<li><p>Do you have more than one GPU or “cldevice”? Then you can tell <strong>dw</strong>
which one to use with the <code class="docutils literal notranslate"><span class="pre">--cldevice</span> <span class="pre">n</span></code> argument, where <span class="math notranslate nohighlight">\(n\)</span>
is the number of the device to use, the first one has number
<span class="math notranslate nohighlight">\(0\)</span>.</p></li>
</ul>
</section>
<section id="do-i-really-need-to-specify-the-number-of-iterations">
<h3>Do I really need to specify the number of iterations?<a class="headerlink" href="#do-i-really-need-to-specify-the-number-of-iterations" title="Link to this heading"></a></h3>
<p>RL-based deconvolution methods are iterative and don’t know when to
stop. While some programs have automatic stop conditions we argue that
it is better if the user specify the number of iterations for two
reasons:</p>
<ol class="arabic simple">
<li><p>How many iterations that are wanted/needed/optimal depends on
downstream analysis. And who knows what your purposes are?</p></li>
<li><p>For consistency. Given a dataset with multiple FOV is makes sense
that each FOV is deconvolved with the same number of iterations. With
an automatic stop functionality, that is probably not the case.</p></li>
</ol>
</section>
<section id="it-takes-a-long-time-before-deconwolf-starts-iterating">
<h3>It takes a long time before deconwolf starts iterating<a class="headerlink" href="#it-takes-a-long-time-before-deconwolf-starts-iterating" title="Link to this heading"></a></h3>
<p>FFTW is self tuning and perform some optimizations whenever presented to
a new problem size. The result of this tuning is called wisdom and is
stored in files like <code class="docutils literal notranslate"><span class="pre">fftw_wisdom_float_threads_16.dat</span></code> by deconwolf
in <code class="docutils literal notranslate"><span class="pre">~/config/deconwolf/</span></code>. Those files can in general not be
transferred to other machines.</p>
<p>This self-tuning can take considerable time but should only be needed
once per problem size. To turn of the self-tuning use the <strong>–noplan</strong>
flag.</p>
</section>
<section id="how-can-i-prepare-tif-files-for-deconwolf">
<h3>How can I prepare tif files for deconwolf?<a class="headerlink" href="#how-can-i-prepare-tif-files-for-deconwolf" title="Link to this heading"></a></h3>
<p>Deconwolf only accept tif files with one channel per file. ImageJ/FIJI
is typically helpful for conversions. For ND2 files check out
<a class="reference external" href="https://github.com/ggirelli/radiantkit">randiantkit</a> or
<a class="reference external" href="https://github.com/elgw/nd2tool">nd2tool</a>.</p>
</section>
<section id="how-do-i-get-metadata-from-nd2-files">
<h3>How do I get metadata from ND2-files?<a class="headerlink" href="#how-do-i-get-metadata-from-nd2-files" title="Link to this heading"></a></h3>
<p>You could use either <a class="reference external" href="https://github.com/elgw/nd2tool">nd2tool</a> or
the more mature
<a class="reference external" href="https://www.openmicroscopy.org/bio-formats/downloads/">showinf</a> from
openmicroscopy. With showinf you could do something like:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>$ bftools/showinf -nopix -omexml iAM337_20190830_001.nd2 &gt; omexml

$ cat omexml | grep -B 1 -A 2 dObjectiveNA
            &lt;OriginalMetadata&gt;
               &lt;Key&gt;dObjectiveNA&lt;/Key&gt;
               &lt;Value&gt;1.45&lt;/Value&gt;
            &lt;/OriginalMetadata&gt;

$ cat omexml | grep EmissionWavelength | grep Channel:0:
         &lt;Channel Color=&quot;-16711681&quot; EmissionWavelength=&quot;810.0&quot; EmissionWavelengthUnit=&quot;nm&quot; ID=&quot;Channel:0:0&quot; Name=&quot;ir800&quot; SamplesPerPixel=&quot;1&quot;&gt;
         &lt;Channel Color=&quot;-2147467009&quot; EmissionWavelength=&quot;700.0&quot; EmissionWavelengthUnit=&quot;nm&quot; ID=&quot;Channel:0:1&quot; Name=&quot;a700&quot; SamplesPerPixel=&quot;1&quot;&gt;
         &lt;Channel Color=&quot;16056319&quot; EmissionWavelength=&quot;488.0&quot; EmissionWavelengthUnit=&quot;nm&quot; ID=&quot;Channel:0:2&quot; Name=&quot;a488&quot; SamplesPerPixel=&quot;1&quot;&gt;
         &lt;Channel Color=&quot;-16776961&quot; EmissionWavelength=&quot;695.0&quot; EmissionWavelengthUnit=&quot;nm&quot; ID=&quot;Channel:0:3&quot; Name=&quot;Cy5&quot; SamplesPerPixel=&quot;1&quot;&gt;
         &lt;Channel Color=&quot;-1241579265&quot; EmissionWavelength=&quot;542.0&quot; EmissionWavelengthUnit=&quot;nm&quot; ID=&quot;Channel:0:4&quot; Name=&quot;tmr&quot; SamplesPerPixel=&quot;1&quot;&gt;
         &lt;Channel Color=&quot;-9109249&quot; EmissionWavelength=&quot;590.0&quot; EmissionWavelengthUnit=&quot;nm&quot; ID=&quot;Channel:0:5&quot; Name=&quot;a594&quot; SamplesPerPixel=&quot;1&quot;&gt;
         &lt;Channel Color=&quot;570490879&quot; EmissionWavelength=&quot;432.0&quot; EmissionWavelengthUnit=&quot;nm&quot; ID=&quot;Channel:0:6&quot; Name=&quot;dapi&quot; SamplesPerPixel=&quot;1&quot;&gt;

$ cat omexml | grep PhysicalSizeZ= | head -n 1
      &lt;Pixels BigEndian=&quot;false&quot; DimensionOrder=&quot;XYCZT&quot; ID=&quot;Pixels:0&quot; Interleaved=&quot;false&quot; PhysicalSizeX=&quot;0.129780110998775&quot; PhysicalSizeXUnit=&quot;µm&quot; PhysicalSizeY=&quot;0.129780110998775&quot; PhysicalSizeYUnit=&quot;µm&quot; PhysicalSizeZ=&quot;0.2&quot; PhysicalSizeZUnit=&quot;µm&quot; SignificantBits=&quot;16&quot; SizeC=&quot;7&quot; SizeT=&quot;1&quot; SizeX=&quot;1024&quot; SizeY=&quot;1024&quot; SizeZ=&quot;81&quot; Type=&quot;uint16&quot;&gt;
   ...
</pre></div>
</div>
</section>
<section id="how-can-i-run-deconwolf-for-many-files">
<h3>How can I run deconwolf for many files?<a class="headerlink" href="#how-can-i-run-deconwolf-for-many-files" title="Link to this heading"></a></h3>
<p>Either use the <a class="reference external" href="https://github.com/elgw/deconwolf-gui">GUI</a>, or write
your own script in your favorite language.</p>
</section>
<section id="dont-you-have-more-psf-models">
<h3>Don’t you have more PSF models?<a class="headerlink" href="#dont-you-have-more-psf-models" title="Link to this heading"></a></h3>
<p>No, not at this time. Please check out the <a class="reference external" href="http://bigwww.epfl.ch/algorithms/psfgenerator/">PSF
Generator</a> from EPFL.</p>
</section>
<section id="what-about-image-dimensions">
<h3>What about image dimensions?<a class="headerlink" href="#what-about-image-dimensions" title="Link to this heading"></a></h3>
<p><strong>dw</strong> report image dimensions in the same way as ImageJ (although dw
does not understand time and channel dimensions). For example the file
<code class="docutils literal notranslate"><span class="pre">dapi_001.tif</span></code> in the <code class="docutils literal notranslate"><span class="pre">demo/</span></code> folder is reported to have the shape
<strong>101x201x40</strong> by dw and ImageJ.</p>
<p>Other tools might report it the other way around, for example:</p>
<p>skimage reports the size <strong>40x201x101</strong> by</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">skimage</span><span class="w"> </span><span class="kn">import</span> <span class="n">io</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span> <span class="o">=</span> <span class="n">io</span><span class="o">.</span><span class="n">imread</span><span class="p">(</span><span class="s1">&#39;dapi_001.tif&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">I</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
<p>In general this is nothing to worry about, see
[<a class="reference external" href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">https://en.wikipedia.org/wiki/Row-_and_column-major_order</a>] for a
discussion around this topic.</p>
</section>
<section id="maximizing-throughput">
<h3>Maximizing throughput<a class="headerlink" href="#maximizing-throughput" title="Link to this heading"></a></h3>
<p>To get a high throughput, i.e., many processed images / hour it is
typically a little faster to process many images in parallel (if enough
RAM). Here are some example timings based on images: [2048x2048x20],
psf: [117x117x39] <strong>–iter 20</strong>, <strong>–bq 2</strong>. Using dw version 0.1.0 on
an AMD Ryzen 3700X:</p>
<ul class="simple">
<li><p>One dw (using <strong>–threads 8</strong>) took 88 s using 7294 MB RAM.</p></li>
</ul>
<p>-&gt; 40 images / hour or 88 s / image</p>
<ul class="simple">
<li><p>Two dw in parallel (using <strong>–threads 4</strong>) took 2 m 44 s using 2x7106
= 14212 MB RAM</p></li>
</ul>
<p>-&gt; 43 images / hour or 82 s / image</p>
<ul class="simple">
<li><p>Four dw in parallel (using <strong>–threads 2</strong>) took 297 s using 6795x4 =
27181 MB RAM</p></li>
</ul>
<p>-&gt; 48 images / hour or 74 s / image</p>
<ul class="simple">
<li><p>Eight dw in parallel (using <strong>–threads 1</strong>) took 9 m 12 s, using
6712x8 = 53696 MB RAM</p></li>
</ul>
<p>-&gt; 52 images / hour or 69 s / image</p>
</section>
<section id="d-images">
<h3>2D images?<a class="headerlink" href="#d-images" title="Link to this heading"></a></h3>
<p>No, that option is deliberately turned off.</p>
</section>
<section id="my-question-was-not-in-this-list">
<h3>My question was not in this list!<a class="headerlink" href="#my-question-was-not-in-this-list" title="Link to this heading"></a></h3>
<p>Then you are welcome to ask it at
[<a class="reference external" href="https://github.com/elgw/deconwolf/issues">https://github.com/elgw/deconwolf/issues</a>].</p>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="install.html" class="btn btn-neutral float-left" title="Installation notes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="spots.html" class="btn btn-neutral float-right" title="Spot detection and measurements" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023-2024, Erik Wernersson.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>